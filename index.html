<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bristol Improv Calendar ‚Äî Beta</title>
  <meta name="description" content="What's on in Bristol improv. Shows, workshops, and jams across the city.">
  
  <meta property="og:title" content="Bristol Improv Calendar ‚Äî Beta">
  <meta property="og:description" content="What's on in Bristol improv. Shows, workshops, and jams across the city.">
  <meta property="og:type" content="website">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body, #root { height: 100%; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;

    // ============================================
    // CONFIGURATION
    // ============================================
    
    const EVENTS_JSON_URL = './events.json';
    const USE_SAMPLE_DATA = false;
    const MIN_YEAR = 2026;
    const MIN_MONTH = 0;
    const KOFI_URL = 'https://ko-fi.com/kaluuja';
    const FEATURE_REQUEST_URL = 'https://forms.gle/J8AJqsfRbz6m1Gbf7';
    
    const SAMPLE_EVENTS = [
      { date: '2026-01-25', title: 'The BLANK who BLANKED me', venue: 'Bristol Improv Theatre', time: '19:00‚Äì20:00', type: 'show', url: '#' },
      { date: '2026-01-28', title: 'Lily Maryon', venue: 'Bristol Improv Theatre', time: '19:30‚Äì21:30', type: 'show', url: '#' },
      { date: '2026-01-28', title: 'Biscuit Barrel', venue: 'Bristol Improv Theatre', time: '20:00‚Äì21:00', type: 'show', url: '#' },
      { date: '2026-01-28', title: 'Luke McQueen', venue: 'Bristol Improv Theatre', time: '21:00‚Äì22:00', type: 'show', url: '#' },
      { date: '2026-01-28', title: 'Open Jam Night', venue: 'Hen & Chicken', time: '19:30‚Äì21:30', type: 'jam', url: '#' },
      { date: '2026-01-30', title: 'Belltower', venue: 'Bristol Improv Theatre', time: '19:30‚Äì21:30', type: 'show', url: '#' },
      { date: '2026-01-31', title: 'Antics Joke Show', venue: 'Bristol Improv Theatre', time: '19:30‚Äì21:30', type: 'show', url: '#' },
      { date: '2026-02-05', title: 'Live in da Hive', venue: 'PRSC', time: '19:00‚Äì22:30', type: 'show', url: '#' },
      { date: '2026-02-06', title: 'The Bish Bosh Bash', venue: 'Bristol Improv Theatre', time: '19:30‚Äì21:30', type: 'show', url: '#' },
      { date: '2026-02-11', title: 'Wednesday Night Improv', venue: 'Hen & Chicken', time: '19:30‚Äì21:30', type: 'show', url: '#' },
      { date: '2026-02-14', title: 'From HELL YEAH! with love', venue: 'Bristol Improv Theatre', time: '19:30‚Äì21:30', type: 'show', url: '#' },
      { date: '2026-02-25', title: 'Tales From The Wasteland', venue: 'Hen & Chicken', time: '19:30‚Äì22:00', type: 'show', url: '#' },
    ];
    
    // ============================================
    // ROADMAP MODAL
    // ============================================
    
    const RoadmapModal = ({ isOpen, onClose, colors }) => {
      if (!isOpen) return null;
      
      const RoadmapItem = ({ done, children }) => (
        <li style={{ 
          marginBottom: '0.6rem',
          display: 'flex',
          alignItems: 'flex-start',
          gap: '0.6rem'
        }}>
          <span style={{ 
            flexShrink: 0,
            width: '22px',
            height: '22px',
            borderRadius: '5px',
            background: done ? colors.sage : 'transparent',
            border: done ? 'none' : `2px solid ${colors.navy}30`,
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            fontSize: '0.75rem',
            color: 'white',
            marginTop: '1px'
          }}>
            {done && '‚úì'}
          </span>
          <span style={{ 
            textDecoration: done ? 'line-through' : 'none',
            color: done ? `${colors.navy}60` : colors.navy,
            fontSize: '0.9rem',
            lineHeight: 1.4
          }}>
            {children}
          </span>
        </li>
      );
      
      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal-content" onClick={e => e.stopPropagation()}>
            <div className="modal-header">
              <h2>üó∫Ô∏è Roadmap</h2>
              <button className="modal-close" onClick={onClose}>‚úï</button>
            </div>
            <div className="modal-body">
              <p className="roadmap-intro">
                This calendar is a work in progress! Here's what's been done and what's coming next. 
                Got an idea? Submit it at the bottom ‚Äî I'd love to hear from you!
              </p>
              
              <div className="roadmap-section">
                <h3>‚ö° Core Functionality</h3>
                <ul>
                  <RoadmapItem done={true}>Monthly calendar view</RoadmapItem>
                  <RoadmapItem done={true}>Navigate between months</RoadmapItem>
                  <RoadmapItem done={true}>Filter by venue</RoadmapItem>
                  <RoadmapItem done={true}>Filter by event type</RoadmapItem>
                  <RoadmapItem done={true}>Search events by name</RoadmapItem>
                  <RoadmapItem done={true}>Mobile-friendly responsive design</RoadmapItem>
                  <RoadmapItem done={true}>Auto-updates from Airtable database</RoadmapItem>
                  <RoadmapItem done={false}>Downloadable calendar feed (ICS/iCal)</RoadmapItem>
                  <RoadmapItem done={false}>Email newsletter for weekly updates</RoadmapItem>
                  <RoadmapItem done={false}>Google Calendar integration</RoadmapItem>
                </ul>
              </div>
              
              <div className="roadmap-section">
                <h3>üé≠ Event Types</h3>
                <ul>
                  <RoadmapItem done={true}>Shows</RoadmapItem>
                  <RoadmapItem done={false}>Workshops & classes</RoadmapItem>
                  <RoadmapItem done={false}>Drop-in jams</RoadmapItem>
                  <RoadmapItem done={false}>Courses & programmes</RoadmapItem>
                  <RoadmapItem done={false}>Improv type tags (shortform, longform, narrative, musical, etc.)</RoadmapItem>
                </ul>
              </div>
              
              <div className="roadmap-section">
                <h3>üìç Venues</h3>
                <ul>
                  <RoadmapItem done={true}>Bristol Improv Theatre</RoadmapItem>
                  <RoadmapItem done={true}>Hen & Chicken (all spaces)</RoadmapItem>
                  <RoadmapItem done={true}>PRSC / SPACE at PRSC</RoadmapItem>
                  <RoadmapItem done={false}>Wardrobe Theatre</RoadmapItem>
                  <RoadmapItem done={false}>Tobacco Factory</RoadmapItem>
                  <RoadmapItem done={false}>Bristol Beacon</RoadmapItem>
                  <RoadmapItem done={false}>Alma Tavern & Theatre</RoadmapItem>
                  <RoadmapItem done={false}>Bristol Old Vic</RoadmapItem>
                  <RoadmapItem done={false}>Redgrave Theatre</RoadmapItem>
                  <RoadmapItem done={false}>St George's Bristol</RoadmapItem>
                  <RoadmapItem done={false}>The Stag & Hounds</RoadmapItem>
                </ul>
              </div>
              
              <div className="roadmap-section">
                <h3>üé® Design & Experience</h3>
                <ul>
                  <RoadmapItem done={true}>Venue colour-coding</RoadmapItem>
                  <RoadmapItem done={true}>Event grouping by venue</RoadmapItem>
                  <RoadmapItem done={false}>Dark mode</RoadmapItem>
                  <RoadmapItem done={false}>List view option</RoadmapItem>
                  <RoadmapItem done={false}>Save favourite events</RoadmapItem>
                </ul>
              </div>
              
              <div className="roadmap-section">
                <h3>üîÆ Future Ideas</h3>
                <ul>
                  <RoadmapItem done={false}>Performer & group profiles</RoadmapItem>
                  <RoadmapItem done={false}>User accounts & personalisation</RoadmapItem>
                  <RoadmapItem done={false}>Event reminders</RoadmapItem>
                  <RoadmapItem done={false}>Community reviews & ratings</RoadmapItem>
                  <RoadmapItem done={false}>Ticket price comparison</RoadmapItem>
                </ul>
              </div>
              
              <div className="roadmap-cta">
                <p>Got an idea that would make this calendar awesome?</p>
                <a href={FEATURE_REQUEST_URL} target="_blank" rel="noopener noreferrer" className="cta-button">
                  üí° Submit your idea
                </a>
                <p className="cta-note">All suggestions welcome ‚Äî big or small!</p>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // ============================================
    // MAIN COMPONENT
    // ============================================

    const BristolImprovCalendar = () => {
      const [selectedDate, setSelectedDate] = useState(null);
      const [venueFilter, setVenueFilter] = useState('all');
      const [typeFilter, setTypeFilter] = useState('all');
      const [searchQuery, setSearchQuery] = useState('');
      const [showSearchResults, setShowSearchResults] = useState(false);
      const [events, setEvents] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [showRoadmap, setShowRoadmap] = useState(false);
      const [lastUpdated, setLastUpdated] = useState(null);
      const [viewYear, setViewYear] = useState(new Date().getFullYear());
      const [viewMonth, setViewMonth] = useState(new Date().getMonth());
      
      const controlsRef = useRef(null);
      
      const colors = {
        cream: '#F4F1DE',
        terracotta: '#E07A5F',
        navy: '#3D405B',
        sage: '#81B29A',
        sand: '#F2CC8F',
      };
      
      const venueStyles = {
        'Bristol Improv Theatre': { color: colors.terracotta, bg: `${colors.terracotta}18`, icon: 'üé™', group: 'Bristol Improv Theatre' },
        'Hen & Chicken': { color: colors.sand, bg: `${colors.sand}25`, icon: 'üêî', group: 'Hen & Chicken' },
        'Hen & Chicken (Chicken Shed)': { color: colors.sand, bg: `${colors.sand}25`, icon: 'üêî', group: 'Hen & Chicken' },
        'Hen & Chicken (Studio)': { color: colors.sand, bg: `${colors.sand}25`, icon: 'üêî', group: 'Hen & Chicken' },
        'PRSC': { color: colors.sage, bg: `${colors.sage}20`, icon: '‚úä', group: 'PRSC' },
        'SPACE at PRSC': { color: colors.sage, bg: `${colors.sage}20`, icon: '‚úä', group: 'PRSC' },
        'Wardrobe Theatre': { color: '#7B68A6', bg: '#7B68A618', icon: 'üö™', group: 'Wardrobe Theatre' },
        'Tobacco Factory': { color: '#8B6F47', bg: '#8B6F4715', icon: 'üè≠', group: 'Tobacco Factory' },
        'Bristol Beacon': { color: '#C4A35A', bg: '#C4A35A15', icon: 'üéµ', group: 'Bristol Beacon' },
      };
      
      const eventTypes = {
        'show': { label: 'Shows', icon: 'üé≠' },
        'workshop': { label: 'Workshops', icon: 'üìö' },
        'jam': { label: 'Jams', icon: 'üé≤' },
      };
      
      // Fetch events
      useEffect(() => {
        const fetchEvents = async () => {
          if (USE_SAMPLE_DATA) {
            setTimeout(() => { setEvents(SAMPLE_EVENTS); setLoading(false); }, 300);
            return;
          }
          try {
            setLoading(true);
            const response = await fetch(EVENTS_JSON_URL + `?t=${Date.now()}`);
            if (!response.ok) throw new Error(`Failed: ${response.status}`);
            const data = await response.json();
            let eventsData = data.events || data.record?.events || data;
            setEvents(Array.isArray(eventsData) ? eventsData : []);
            setLastUpdated(data.lastUpdated || data.record?.lastUpdated);
            setError(null);
          } catch (err) {
            setEvents(SAMPLE_EVENTS);
            setError(`Using sample data`);
          } finally {
            setLoading(false);
          }
        };
        fetchEvents();
      }, []);
      
      // Close search on outside click
      useEffect(() => {
        const handleClick = (e) => {
          if (controlsRef.current && !controlsRef.current.contains(e.target)) {
            setShowSearchResults(false);
          }
        };
        document.addEventListener('mousedown', handleClick);
        return () => document.removeEventListener('mousedown', handleClick);
      }, []);
      
      const today = new Date();
      const todayYear = today.getFullYear();
      const todayMonth = today.getMonth();
      const todayDate = today.getDate();
      
      const maxEventDate = useMemo(() => {
        if (events.length === 0) return { year: todayYear, month: todayMonth };
        let maxY = MIN_YEAR, maxM = MIN_MONTH;
        events.forEach(e => {
          const d = new Date(e.date);
          if (d.getFullYear() > maxY || (d.getFullYear() === maxY && d.getMonth() > maxM)) {
            maxY = d.getFullYear();
            maxM = d.getMonth();
          }
        });
        return { year: maxY, month: maxM };
      }, [events]);
      
      const canGoBack = viewYear > MIN_YEAR || (viewYear === MIN_YEAR && viewMonth > MIN_MONTH);
      const canGoForward = viewYear < maxEventDate.year || (viewYear === maxEventDate.year && viewMonth < maxEventDate.month);
      const isCurrentMonth = viewYear === todayYear && viewMonth === todayMonth;
      
      const daysInMonth = new Date(viewYear, viewMonth + 1, 0).getDate();
      const firstDay = new Date(viewYear, viewMonth, 1).getDay();
      const startDay = firstDay === 0 ? 6 : firstDay - 1;
      
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      const monthShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
      
      const goToPrevMonth = () => {
        if (!canGoBack) return;
        setSelectedDate(null);
        setViewMonth(viewMonth === 0 ? 11 : viewMonth - 1);
        setViewYear(viewMonth === 0 ? viewYear - 1 : viewYear);
      };
      
      const goToNextMonth = () => {
        if (!canGoForward) return;
        setSelectedDate(null);
        setViewMonth(viewMonth === 11 ? 0 : viewMonth + 1);
        setViewYear(viewMonth === 11 ? viewYear + 1 : viewYear);
      };
      
      const goToToday = () => {
        setSelectedDate(null);
        setViewYear(todayYear);
        setViewMonth(todayMonth);
      };
      
      const getVenueGroup = (venue) => venueStyles[venue]?.group || 
        (venue.startsWith('Hen & Chicken') ? 'Hen & Chicken' : 
         venue.includes('PRSC') ? 'PRSC' : venue);
      
      const getVenueInfo = (venue) => venueStyles[venue] || 
        { color: colors.navy, bg: `${colors.navy}15`, icon: 'üìç', group: venue };
      
      const getEventsForDate = (date) => {
        return events.filter(e => {
          const d = new Date(e.date);
          if (d.getMonth() !== viewMonth || d.getFullYear() !== viewYear || d.getDate() !== date) return false;
          const group = getVenueGroup(e.venue);
          const matchVenue = venueFilter === 'all' || group === venueFilter;
          const matchType = typeFilter === 'all' || e.type === typeFilter;
          return matchVenue && matchType;
        });
      };
      
      // Group events by venue for calendar preview
      const getVenueGroupsForDate = (date) => {
        const dateEvents = getEventsForDate(date);
        const groups = {};
        dateEvents.forEach(e => {
          const g = getVenueGroup(e.venue);
          if (!groups[g]) groups[g] = { count: 0, info: getVenueInfo(e.venue), events: [] };
          groups[g].count++;
          groups[g].events.push(e);
        });
        return Object.entries(groups);
      };
      
      // Search
      const searchResults = useMemo(() => {
        if (!searchQuery.trim()) return [];
        const q = searchQuery.toLowerCase();
        return events.filter(e => 
          e.title.toLowerCase().includes(q) || 
          e.venue.toLowerCase().includes(q) ||
          (e.description?.toLowerCase().includes(q))
        ).slice(0, 8);
      }, [searchQuery, events]);
      
      const handleSearchSelect = (event) => {
        const d = new Date(event.date);
        setViewYear(d.getFullYear());
        setViewMonth(d.getMonth());
        setSelectedDate(d.getDate());
        setSearchQuery('');
        setShowSearchResults(false);
      };
      
      // Active filters for dropdowns
      const activeVenueGroups = useMemo(() => {
        const s = new Set();
        events.forEach(e => s.add(getVenueGroup(e.venue)));
        return s;
      }, [events]);
      
      const activeTypes = useMemo(() => {
        const s = new Set();
        events.forEach(e => e.type && s.add(e.type));
        return s;
      }, [events]);
      
      const formatLastUpdated = (str) => {
        if (!str) return null;
        const d = new Date(str);
        const mins = Math.floor((new Date() - d) / 60000);
        if (mins < 60) return `${mins}m ago`;
        const hrs = Math.floor(mins / 60);
        if (hrs < 24) return `${hrs}h ago`;
        return d.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
      };
      
      const formatEventDate = (str) => {
        const d = new Date(str);
        return d.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
      };
      
      const getDayName = (date) => ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][new Date(viewYear, viewMonth, date).getDay()];
      
      const getShortTitle = (title, maxLen = 16) => {
        const short = title.replace(/^The\s+/i, '').replace(/[:|].*$/, '').trim();
        return short.length > maxLen ? short.substring(0, maxLen - 1) + '‚Ä¶' : short;
      };
      
      const weeksNeeded = Math.ceil((startDay + daysInMonth) / 7);
      
      const renderDays = () => {
        const days = [];
        for (let i = 0; i < startDay; i++) {
          days.push(<div key={`e-${i}`} className="cal-day empty"></div>);
        }
        for (let date = 1; date <= daysInMonth; date++) {
          const venues = getVenueGroupsForDate(date);
          const allEvents = venues.flatMap(([_, { events }]) => events);
          const hasEvents = venues.length > 0;
          const isSelected = selectedDate === date;
          const dayIdx = (startDay + date - 1) % 7;
          const isWeekend = dayIdx >= 5;
          const isToday = viewYear === todayYear && viewMonth === todayMonth && date === todayDate;
          
          days.push(
            <div
              key={date}
              className={`cal-day ${hasEvents ? 'has-events' : ''} ${isSelected ? 'selected' : ''} ${isWeekend ? 'weekend' : ''} ${isToday ? 'today' : ''}`}
              onClick={() => hasEvents && setSelectedDate(isSelected ? null : date)}
            >
              <span className={`date-num ${isToday ? 'today-num' : ''}`}>{date}</span>
              {hasEvents && (
                <div className="event-previews">
                  {/* Desktop: show event titles */}
                  <div className="desktop-events">
                    {allEvents.slice(0, 3).map((e, i) => {
                      const info = getVenueInfo(e.venue);
                      return (
                        <div key={i} className="event-chip" style={{ background: info.bg, borderColor: info.color }}>
                          <span className="chip-icon">{info.icon}</span>
                          <span className="chip-title">{getShortTitle(e.title)}</span>
                        </div>
                      );
                    })}
                    {allEvents.length > 3 && <span className="more">+{allEvents.length - 3} more</span>}
                  </div>
                  {/* Mobile: show venue icons only */}
                  <div className="mobile-events">
                    {venues.slice(0, 3).map(([g, { count, info }]) => (
                      <div key={g} className="venue-chip" style={{ background: info.bg, borderColor: info.color }}>
                        <span className="chip-icon">{info.icon}</span>
                        {count > 1 && <span className="chip-count">{count}</span>}
                      </div>
                    ))}
                    {venues.length > 3 && <span className="more">+{venues.length - 3}</span>}
                  </div>
                </div>
              )}
            </div>
          );
        }
        return days;
      };
      
      const selectedEvents = selectedDate ? getEventsForDate(selectedDate) : [];
      
      return (
        <div className="app">
          <style>{`
            .app {
              display: flex;
              flex-direction: column;
              height: 100vh;
              background: ${colors.cream};
              font-family: 'Nunito', sans-serif;
              color: ${colors.navy};
              overflow: hidden;
            }
            
            /* HEADER */
            .header {
              background: ${colors.navy};
              padding: 0.6rem 1rem;
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 0.75rem;
              flex-shrink: 0;
            }
            .header-left {
              display: flex;
              align-items: center;
              gap: 0.5rem;
              min-width: 0;
            }
            .header h1 {
              font-size: 1.3rem;
              font-weight: 800;
              color: ${colors.cream};
              white-space: nowrap;
              line-height: 1.1;
            }
            .beta {
              background: ${colors.terracotta};
              color: white;
              font-size: 0.55rem;
              font-weight: 700;
              padding: 0.15rem 0.4rem;
              border-radius: 3px;
              text-transform: uppercase;
              flex-shrink: 0;
            }
            .header-center {
              display: flex;
              align-items: center;
              gap: 0.5rem;
            }
            .nav-btn {
              background: transparent;
              border: 2px solid ${colors.cream}40;
              color: ${colors.cream};
              width: 28px;
              height: 28px;
              border-radius: 5px;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 0.9rem;
              transition: all 0.15s;
            }
            .nav-btn:hover:not(:disabled) { background: ${colors.cream}15; border-color: ${colors.cream}; }
            .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
            .month-label {
              font-size: 0.8rem;
              font-weight: 600;
              color: ${colors.sage};
              text-transform: uppercase;
              letter-spacing: 0.08em;
              min-width: 100px;
              text-align: center;
            }
            .month-full { display: inline; }
            .month-short { display: none; }
            .today-btn {
              font-size: 0.6rem;
              font-weight: 700;
              padding: 0.3rem 0.5rem;
              background: ${colors.sage};
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              text-transform: uppercase;
            }
            .today-btn:disabled { opacity: 0.4; cursor: not-allowed; }
            .roadmap-btn {
              font-size: 0.7rem;
              font-weight: 600;
              padding: 0.35rem 0.6rem;
              background: transparent;
              border: 2px solid ${colors.cream}40;
              color: ${colors.cream};
              border-radius: 5px;
              cursor: pointer;
              display: flex;
              align-items: center;
              gap: 0.3rem;
              white-space: nowrap;
            }
            .roadmap-btn:hover { background: ${colors.cream}15; border-color: ${colors.cream}; }
            
            /* CONTROLS */
            .controls {
              background: white;
              border-bottom: 2px solid ${colors.cream};
              padding: 0.5rem 0.75rem;
              display: flex;
              flex-wrap: wrap;
              gap: 0.5rem;
              align-items: center;
              justify-content: center;
              flex-shrink: 0;
              position: relative;
            }
            .controls-inner {
              display: flex;
              gap: 0.5rem;
              align-items: center;
              justify-content: center;
              position: relative;
              width: 100%;
              max-width: 600px;
            }
            .search-box {
              position: static;
              width: 180px;
              flex-shrink: 0;
            }
            .search-input {
              width: 100%;
              padding: 0.4rem 0.5rem 0.4rem 1.8rem;
              border: 2px solid ${colors.navy}20;
              border-radius: 16px;
              font-size: 0.75rem;
              font-family: inherit;
              color: ${colors.navy};
            }
            .search-input:focus { outline: none; border-color: ${colors.terracotta}; }
            .search-icon {
              position: absolute;
              left: 0.6rem;
              top: 50%;
              transform: translateY(-50%);
              font-size: 0.7rem;
              pointer-events: none;
            }
            .search-results {
              position: absolute;
              top: 100%;
              left: 0;
              right: 0;
              background: white;
              border-radius: 8px;
              box-shadow: 0 4px 20px rgba(0,0,0,0.15);
              margin-top: 4px;
              z-index: 100;
              max-height: 320px;
              overflow-y: auto;
            }
            .search-item {
              padding: 0.7rem 0.85rem;
              cursor: pointer;
              border-bottom: 1px solid ${colors.cream};
            }
            .search-item:hover { background: ${colors.cream}; }
            .search-item:last-child { border-bottom: none; }
            .search-title { font-size: 0.85rem; font-weight: 600; color: ${colors.navy}; }
            .search-meta { font-size: 0.75rem; color: ${colors.navy}80; margin-top: 0.15rem; }
            
            .filter-select {
              font-family: inherit;
              font-size: 0.75rem;
              font-weight: 600;
              padding: 0.4rem 1.6rem 0.4rem 0.6rem;
              border: 2px solid ${colors.navy}20;
              border-radius: 6px;
              background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%233D405B' d='M2 4l3 3 3-3H2z'/%3E%3C/svg%3E") no-repeat right 0.5rem center;
              color: ${colors.navy};
              cursor: pointer;
              appearance: none;
              flex: 1;
              min-width: 0;
            }
            .filter-select:focus { outline: none; border-color: ${colors.terracotta}; }
            .filter-select.active { border-color: ${colors.terracotta}; background-color: ${colors.terracotta}10; }
            
            /* MAIN LAYOUT */
            .main {
              display: flex;
              flex: 1;
              overflow: hidden;
              min-height: 0;
            }
            
            /* CALENDAR */
            .calendar {
              flex: 1;
              display: flex;
              flex-direction: column;
              overflow: hidden;
            }
            .cal-grid {
              display: grid;
              grid-template-columns: repeat(7, 1fr);
              grid-template-rows: auto repeat(${weeksNeeded}, 1fr);
              gap: 4px;
              padding: 0.5rem;
              flex: 1;
              min-height: 0;
            }
            .day-hdr {
              font-size: 0.7rem;
              font-weight: 700;
              text-align: center;
              padding: 0.4rem 0;
              color: ${colors.navy}90;
              text-transform: uppercase;
            }
            .cal-day {
              background: white;
              border-radius: 6px;
              padding: 0.3rem;
              display: flex;
              flex-direction: column;
              border: 2px solid transparent;
              overflow: hidden;
              min-height: 0;
            }
            .cal-day.empty { background: transparent; border: none; }
            .cal-day.weekend { background: #fffdf8; }
            .cal-day.today { border-color: ${colors.terracotta}50; background: ${colors.terracotta}08; }
            .cal-day.has-events { cursor: pointer; }
            .cal-day.has-events:hover { border-color: ${colors.sage}; transform: scale(1.02); z-index: 1; }
            .cal-day.selected { border-color: ${colors.terracotta}; box-shadow: 0 2px 8px ${colors.terracotta}30; z-index: 2; }
            .date-num {
              font-size: 0.8rem;
              font-weight: 700;
              color: ${colors.navy}50;
              margin-bottom: 0.2rem;
              flex-shrink: 0;
            }
            .has-events .date-num { color: ${colors.navy}; }
            .date-num.today-num { color: ${colors.terracotta}; }
            
            .event-previews {
              flex: 1;
              overflow: hidden;
              display: flex;
              flex-direction: column;
              gap: 2px;
            }
            
            /* Desktop events - show titles */
            .desktop-events {
              display: flex;
              flex-direction: column;
              gap: 2px;
            }
            .event-chip {
              display: flex;
              align-items: center;
              gap: 3px;
              padding: 2px 4px;
              border-radius: 3px;
              border-left: 2px solid;
              overflow: hidden;
            }
            .chip-icon { font-size: 0.65rem; flex-shrink: 0; }
            .chip-title {
              font-size: 0.6rem;
              font-weight: 600;
              color: ${colors.navy};
              white-space: nowrap;
              overflow: hidden;
              text-overflow: ellipsis;
            }
            
            /* Mobile events - icons only */
            .mobile-events {
              display: none;
              flex-wrap: wrap;
              gap: 2px;
            }
            .venue-chip {
              display: flex;
              align-items: center;
              gap: 1px;
              padding: 2px 4px;
              border-radius: 3px;
              border-left: 2px solid;
            }
            .chip-count { font-size: 0.55rem; font-weight: 700; color: ${colors.navy}70; }
            .more { font-size: 0.55rem; color: ${colors.navy}60; padding: 2px; }
            
            /* DETAIL PANEL */
            .detail {
              width: 320px;
              background: white;
              border-left: 3px solid ${colors.cream};
              overflow-y: auto;
              flex-shrink: 0;
              display: flex;
              flex-direction: column;
            }
            .detail-inner { padding: 1rem; flex: 1; overflow-y: auto; }
            .detail-hdr {
              font-size: 1.05rem;
              font-weight: 700;
              color: ${colors.terracotta};
              margin-bottom: 0.75rem;
              padding-bottom: 0.5rem;
              border-bottom: 2px solid ${colors.cream};
            }
            .event-card {
              display: block;
              background: ${colors.cream};
              border-radius: 8px;
              padding: 0.85rem;
              margin-bottom: 0.6rem;
              text-decoration: none;
              color: inherit;
              border-left: 4px solid;
              transition: transform 0.15s;
            }
            .event-card:hover { transform: translateX(3px); }
            .event-row { display: flex; gap: 0.6rem; }
            .event-icon { font-size: 1.3rem; }
            .event-info { flex: 1; min-width: 0; }
            .event-title { font-size: 0.85rem; font-weight: 700; margin-bottom: 0.25rem; }
            .event-meta { font-size: 0.75rem; color: ${colors.navy}80; }
            .event-meta span { display: block; }
            .event-cta { font-size: 0.7rem; font-weight: 700; color: ${colors.terracotta}; margin-top: 0.5rem; }
            .no-select {
              flex: 1;
              display: flex;
              align-items: center;
              justify-content: center;
              text-align: center;
              padding: 1rem;
              color: ${colors.navy}60;
              font-size: 0.85rem;
            }
            .clash { background: ${colors.sand}40; border: 2px solid ${colors.sand}; border-radius: 6px; padding: 0.5rem 0.6rem; font-size: 0.75rem; font-weight: 600; margin-bottom: 0.6rem; }
            
            /* MAIN FOOTER */
            .kofi-bar {
              background: linear-gradient(135deg, ${colors.sage}20, ${colors.sand}30);
              border-top: 2px solid ${colors.cream};
              padding: 0.5rem 1rem;
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 0.6rem;
              flex-shrink: 0;
            }
            .kofi-text { font-size: 0.75rem; font-weight: 600; color: ${colors.navy}; }
            .kofi-btn {
              display: inline-flex;
              align-items: center;
              gap: 0.3rem;
              background: #FF5E5B;
              color: white;
              padding: 0.35rem 0.7rem;
              border-radius: 5px;
              font-size: 0.7rem;
              font-weight: 700;
              text-decoration: none;
            }
            .kofi-btn:hover { transform: scale(1.05); }
            .footer {
              background: white;
              border-top: 2px solid ${colors.cream};
              padding: 0.5rem;
              text-align: center;
              font-size: 0.65rem;
              flex-shrink: 0;
            }
            .footer-text { color: ${colors.navy}; }
            .footer a { color: ${colors.terracotta}; font-weight: 700; text-decoration: none; }
            .footer-updated { color: ${colors.navy}60; margin-left: 0.4rem; }
            
            /* LOADING */
            .loading {
              flex: 1;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              gap: 0.75rem;
              color: ${colors.navy}80;
            }
            .spinner {
              width: 36px;
              height: 36px;
              border: 4px solid ${colors.cream};
              border-top-color: ${colors.terracotta};
              border-radius: 50%;
              animation: spin 1s linear infinite;
            }
            @keyframes spin { to { transform: rotate(360deg); } }
            
            /* MODAL */
            .modal-overlay {
              position: fixed;
              inset: 0;
              background: rgba(61,64,91,0.75);
              display: flex;
              align-items: center;
              justify-content: center;
              z-index: 1000;
              padding: 1rem;
            }
            .modal-content {
              background: white;
              border-radius: 14px;
              max-width: 540px;
              width: 100%;
              max-height: 90vh;
              overflow: hidden;
              display: flex;
              flex-direction: column;
              box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            }
            .modal-header {
              background: ${colors.navy};
              color: ${colors.cream};
              padding: 1rem 1.25rem;
              display: flex;
              justify-content: space-between;
              align-items: center;
            }
            .modal-header h2 { font-size: 1.2rem; margin: 0; }
            .modal-close { background: none; border: none; color: ${colors.cream}; font-size: 1.2rem; cursor: pointer; opacity: 0.7; }
            .modal-close:hover { opacity: 1; }
            .modal-body { padding: 1.25rem; overflow-y: auto; flex: 1; }
            .roadmap-intro { font-size: 0.9rem; color: ${colors.navy}90; margin-bottom: 1.25rem; line-height: 1.5; }
            .roadmap-section { margin-bottom: 1.5rem; }
            .roadmap-section h3 { font-size: 1rem; font-weight: 700; margin-bottom: 0.6rem; padding-bottom: 0.4rem; border-bottom: 2px solid ${colors.cream}; }
            .roadmap-section ul { list-style: none; }
            .roadmap-cta { background: ${colors.cream}; border-radius: 10px; padding: 1rem; text-align: center; margin-top: 0.5rem; }
            .roadmap-cta p { font-size: 0.9rem; font-weight: 600; margin-bottom: 0.6rem; }
            .roadmap-cta .cta-note { font-size: 0.75rem; color: ${colors.navy}70; margin-top: 0.5rem; margin-bottom: 0; }
            .cta-button { display: inline-block; background: ${colors.terracotta}; color: white; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.85rem; font-weight: 700; text-decoration: none; }
            .cta-button:hover { transform: scale(1.03); }
            
            /* ============================================
               MOBILE STYLES
               ============================================ */
            @media (max-width: 768px) {
              .main { flex-direction: column; }
              
              /* Fixed height calendar */
              .calendar {
                flex: none;
                height: 52vh;
                min-height: 300px;
              }
              
              /* Detail panel - compact when no selection */
              .detail {
                width: 100%;
                flex: 1;
                border-left: none;
                border-top: 3px solid ${colors.cream};
                min-height: 0;
              }
              
              /* Compact no-selection message on mobile */
              .no-select {
                padding: 0.5rem;
                font-size: 0.75rem;
              }
              
              /* Header adjustments */
              .header {
                padding: 0.5rem 0.6rem;
                gap: 0.4rem;
              }
              .header h1 {
                font-size: 0.9rem;
                white-space: normal;
                line-height: 1.15;
              }
              .header-left { gap: 0.35rem; }
              .beta { font-size: 0.45rem; padding: 0.12rem 0.3rem; }
              .month-full { display: none; }
              .month-short { display: inline; }
              .month-label { min-width: 70px; font-size: 0.7rem; }
              .nav-btn { width: 24px; height: 24px; font-size: 0.8rem; }
              .today-btn { font-size: 0.5rem; padding: 0.25rem 0.4rem; }
              .roadmap-btn { padding: 0.25rem 0.4rem; font-size: 0.6rem; }
              .roadmap-btn span { display: none; }
              
              /* Controls - all on one line */
              .controls {
                padding: 0.4rem 0.5rem;
              }
              .controls-inner {
                gap: 0.35rem;
                flex-wrap: nowrap;
              }
              .search-box { 
                width: auto;
                flex: 1;
                min-width: 70px;
              }
              .search-input {
                padding: 0.3rem 0.4rem 0.3rem 1.5rem;
                font-size: 0.65rem;
              }
              .search-icon { font-size: 0.6rem; left: 0.5rem; }
              .filter-select { 
                font-size: 0.65rem; 
                padding: 0.3rem 1.3rem 0.3rem 0.4rem;
                flex: 1;
              }
              
              /* Calendar grid */
              .cal-grid { padding: 0.3rem; gap: 2px; }
              .day-hdr { font-size: 0.6rem; padding: 0.25rem 0; }
              .cal-day { padding: 0.2rem; border-radius: 4px; }
              .date-num { font-size: 0.65rem; margin-bottom: 0.1rem; }
              
              /* Show mobile events, hide desktop */
              .desktop-events { display: none; }
              .mobile-events { display: flex; }
              .chip-icon { font-size: 0.55rem; }
              .chip-count { font-size: 0.5rem; }
              
              /* Mobile footer */
              .kofi-bar {
                padding: 0.35rem 0.5rem;
                gap: 0.35rem;
                flex-wrap: wrap;
              }
              .kofi-text { font-size: 0.6rem; }
              .kofi-btn { font-size: 0.55rem; padding: 0.25rem 0.45rem; }
              .footer { font-size: 0.5rem; padding: 0.3rem; }
            }
            
            @media (max-width: 380px) {
              .header h1 { font-size: 0.8rem; }
              .filter-select { font-size: 0.6rem; padding: 0.25rem 1.2rem 0.25rem 0.35rem; }
            }
          `}</style>
          
          <header className="header">
            <div className="header-left">
              <h1>Bristol Improv Calendar</h1>
              <span className="beta">Beta</span>
            </div>
            <div className="header-center">
              <button className="nav-btn" onClick={goToPrevMonth} disabled={!canGoBack}>‚Üê</button>
              <span className="month-label">
                <span className="month-full">{monthNames[viewMonth]} {viewYear}</span>
                <span className="month-short">{monthShort[viewMonth]} {viewYear}</span>
              </span>
              <button className="nav-btn" onClick={goToNextMonth} disabled={!canGoForward}>‚Üí</button>
              <button className="today-btn" onClick={goToToday} disabled={isCurrentMonth}>Today</button>
            </div>
            <button className="roadmap-btn" onClick={() => setShowRoadmap(true)}>
              üó∫Ô∏è <span>Roadmap</span>
            </button>
          </header>
          
          {error && <div style={{ background: `${colors.sand}30`, textAlign: 'center', fontSize: '0.6rem', padding: '0.25rem', color: colors.navy }}>‚ö†Ô∏è {error}</div>}
          
          {loading ? (
            <div className="loading">
              <div className="spinner"></div>
              <div>Loading events...</div>
            </div>
          ) : (
            <>
              <div className="controls" ref={controlsRef}>
                <div className="controls-inner">
                  <div className="search-box">
                    <span className="search-icon">üîç</span>
                    <input
                      type="text"
                      className="search-input"
                      placeholder="Search..."
                      value={searchQuery}
                      onChange={e => { setSearchQuery(e.target.value); setShowSearchResults(true); }}
                      onFocus={() => setShowSearchResults(true)}
                    />
                  </div>
                  <select 
                    className={`filter-select ${typeFilter !== 'all' ? 'active' : ''}`}
                    value={typeFilter}
                    onChange={e => setTypeFilter(e.target.value)}
                  >
                    <option value="all">All Events</option>
                    {Object.entries(eventTypes).map(([k, v]) => (
                      <option key={k} value={k} disabled={!activeTypes.has(k)}>{v.icon} {v.label}</option>
                    ))}
                  </select>
                  <select 
                    className={`filter-select ${venueFilter !== 'all' ? 'active' : ''}`}
                    value={venueFilter}
                    onChange={e => setVenueFilter(e.target.value)}
                  >
                    <option value="all">All Venues</option>
                    {Object.entries(venueStyles)
                      .filter(([k, v]) => v.group === k)
                      .map(([k, v]) => (
                        <option key={k} value={k} disabled={!activeVenueGroups.has(k)}>{v.icon} {k}</option>
                      ))}
                  </select>
                  {showSearchResults && searchResults.length > 0 && (
                    <div className="search-results">
                      {searchResults.map((e, i) => (
                        <div key={i} className="search-item" onClick={() => handleSearchSelect(e)}>
                          <div className="search-title">{e.title}</div>
                          <div className="search-meta">{formatEventDate(e.date)} ‚Ä¢ {e.venue}</div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
              
              <div className="main">
                <div className="calendar">
                  <div className="cal-grid">
                    {dayNames.map(d => <div key={d} className="day-hdr">{d}</div>)}
                    {renderDays()}
                  </div>
                </div>
                
                <div className="detail">
                  {selectedDate ? (
                    <div className="detail-inner">
                      <h3 className="detail-hdr">{getDayName(selectedDate)} {selectedDate} {monthShort[viewMonth]}</h3>
                      {selectedEvents.length > 1 && (
                        <div className="clash">‚ö†Ô∏è {selectedEvents.length} events ‚Äî pick your poison!</div>
                      )}
                      {selectedEvents.map((e, i) => {
                        const info = getVenueInfo(e.venue);
                        return (
                          <a key={i} href={e.url} target="_blank" rel="noopener noreferrer" className="event-card" style={{ borderColor: info.color }}>
                            <div className="event-row">
                              <span className="event-icon">{info.icon}</span>
                              <div className="event-info">
                                <div className="event-title">{e.title}</div>
                                <div className="event-meta">
                                  <span>üìç {e.venue}</span>
                                  <span>üïñ {e.time}</span>
                                </div>
                                <div className="event-cta">View details / Book tickets ‚Üí</div>
                              </div>
                            </div>
                          </a>
                        );
                      })}
                    </div>
                  ) : (
                    <div className="no-select">
                      <p>üëà Click a date to see event details</p>
                    </div>
                  )}
                </div>
              </div>
            </>
          )}
          
          {/* Footer - always visible at bottom */}
          <div className="kofi-bar">
            <span className="kofi-text">‚òï Find this useful? Buy Ste a tea/pint!</span>
            <a href={KOFI_URL} target="_blank" rel="noopener noreferrer" className="kofi-btn">‚ù§Ô∏è Support on Ko-fi</a>
          </div>
          <footer className="footer">
            <span className="footer-text">Missing a show? Got corrections?</span> <a href="mailto:ste@youremail.com">Let us know</a>
            {lastUpdated && <span className="footer-updated">‚Ä¢ Updated {formatLastUpdated(lastUpdated)}</span>}
          </footer>
          
          <RoadmapModal isOpen={showRoadmap} onClose={() => setShowRoadmap(false)} colors={colors} />
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<BristolImprovCalendar />);
  </script>
</body>
</html>
